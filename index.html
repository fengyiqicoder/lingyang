<!DOCTYPE html>
<html lang="zh">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YXELY2S8NR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YXELY2S8NR');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢†å…»åè®®ç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- æ·»åŠ  html2canvas åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- æ·»åŠ  jsPDF åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- html2pdf åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <!-- å¤´éƒ¨ -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">ğŸ¶é¢†å…»åè®®ç”Ÿæˆå™¨</h1>
            <p class="text-gray-600 mt-2">å¸®æ¯ä¸€åªå® ç‰©éƒ½æ‰¾åˆ°æ¸©æš–çš„å®¶</p>
            
            <!-- æ·»åŠ å¾®ä¿¡æç¤º -->
            <div id="wechatTip" class="hidden mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4 mx-auto max-w-md">
                <p class="text-yellow-700">
                    <span class="font-medium">æç¤ºï¼š</span>
                    è¯·åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æœ¬ç½‘é¡µï¼Œå¾®ä¿¡å†…æ— æ³•æ­£å¸¸ä¸‹è½½æ–‡ä»¶ã€‚
                </p>
            </div>
        </header>

        <!-- ä¸»è¡¨å• -->
        <form class="max-w-4xl mx-auto bg-white rounded-lg shadow-md p-6">
            <!-- å® ç‰©åŸºæœ¬ä¿¡æ¯ -->
            <section class="mb-8">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">å® ç‰©åŸºæœ¬ä¿¡æ¯</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2">ğŸ¾ åå­—</label>
                        <input type="text" id="petName" class="w-full px-3 py-2 border rounded-lg" placeholder="è¯·è¾“å…¥å® ç‰©åå­—">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ğŸ“… å¹´é¾„</label>
                        <input type="number" 
                               id="petAge" 
                               step="0.1" 
                               class="w-full px-3 py-2 border rounded-lg" 
                               placeholder="è¯·è¾“å…¥å® ç‰©å¹´é¾„ï¼ˆå²ï¼‰">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">âš¤ æ€§åˆ«</label>
                        <select id="petGender" class="w-full px-3 py-2 border rounded-lg">
                            <option>ç”·ç”Ÿ</option>
                            <option>å¥³ç”Ÿ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ğŸ• å“ç§</label>
                        <input type="text" 
                               id="petBreed"
                               class="w-full px-3 py-2 border rounded-lg" 
                               placeholder="ä¾‹ï¼šé‡‘æ¯›ã€æ©˜çŒ«">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">âš–ï¸ ä½“é‡ï¼ˆkgï¼‰</label>
                        <input type="number" 
                               id="petWeight"
                               step="0.1" 
                               class="w-full px-3 py-2 border rounded-lg" 
                               placeholder="è¯·è¾“å…¥ä½“é‡">
                    </div>
                </div>
            </section>

            <!-- é¢†å…»èƒŒæ™¯ -->
            <section class="mb-8">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">é¢†å…»èƒŒæ™¯</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2">ğŸ“ å¯æ¥å—é¢†å…»åœ°ç‚¹</label>
                        <input type="text" 
                               id="adoptionLocation"
                               class="w-full px-3 py-2 border rounded-lg" 
                               placeholder="ä¾‹ï¼šåŒ—äº¬å¸‚æµ·æ·€åŒº/å…¨åŒ—äº¬/ä»…é™æœ¬åœ°">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ğŸ“ å® ç‰©æ¥å†</label>
                        <select id="petOrigin" class="w-full px-3 py-2 border rounded-lg">
                            <option>æµæµªæ•‘åŠ©</option>
                            <option>ä¸ªäººé€å…»</option>
                            <option>ç¹è‚²å®¶åº­</option>
                            <option>å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 mb-2">ğŸ’­ é¢†å…»åŸå› </label>
                        <textarea id="adoptionReason" class="w-full px-3 py-2 border rounded-lg" rows="3" 
                            placeholder="è¯·è¯´æ˜é€å…»åŸå› ï¼Œä¾‹ï¼šä¸»äººå·¥ä½œè°ƒåŠ¨/æ— åŠ›ç»§ç»­ç…§é¡¾ç­‰"></textarea>
                    </div>
                </div>
            </section>

            <!-- å¥åº·çŠ¶å†µ -->
            <section class="mb-8">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">å¥åº·çŠ¶å†µ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2">ğŸ’‰ ç–«è‹—æƒ…å†µ</label>
                        <select id="vaccineStatus" class="w-full px-3 py-2 border rounded-lg">
                            <option>å·²å®Œæˆå…¨éƒ¨ç–«è‹—</option>
                            <option>éƒ¨åˆ†æ¥ç§</option>
                            <option>æœªæ¥ç§</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">âœ‚ï¸ ç»è‚²çŠ¶æ€</label>
                        <select id="sterilizationStatus" class="w-full px-3 py-2 border rounded-lg">
                            <option>å·²ç»è‚²</option>
                            <option>æœªç»è‚²</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ğŸ¥ æ˜¯å¦ä½“æ£€</label>
                        <select id="medicalCheckStatus" class="w-full px-3 py-2 border rounded-lg">
                            <option>å·²ä½“æ£€</option>
                            <option>æœªä½“æ£€</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 mb-2">ğŸ¥ æ‚£ç—…å†å²</label>
                        <textarea id="medicalHistory" 
                                  class="w-full px-3 py-2 border rounded-lg" 
                                  rows="3" 
                                  placeholder="è¯·è¯¦ç»†æè¿°å® ç‰©æ›¾ç»çš„ç—…å²ï¼Œå¦‚æ— è¯·å¡«å†™'æ— 'ã€‚ä¾‹ï¼šå»å¹´åšè¿‡ä¸€æ¬¡éª¨æŠ˜æ‰‹æœ¯ï¼Œç°å·²ç—Šæ„ˆ"></textarea>
                    </div>
                </div>
            </section>

            <!-- è¡Œä¸ºä¹ æ€§ -->
            <section class="mb-8">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">è¡Œä¸ºä¹ æ€§</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2">ğŸš½ å®šç‚¹å¤§å°ä¾¿æƒ…å†µ</label>
                        <select id="toiletHabit" class="w-full px-3 py-2 border rounded-lg">
                            <option>å·²å…»æˆä¹ æƒ¯</option>
                            <option>æ­£åœ¨è®­ç»ƒä¸­</option>
                            <option>éœ€è¦è®­ç»ƒ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ğŸ”Š åµé—¹çŠ¶å†µ</label>
                        <select id="noiseLevel" class="w-full px-3 py-2 border rounded-lg">
                            <option>å®‰é™</option>
                            <option>å¶å°”å«</option>
                            <option>æ¯”è¾ƒçˆ±å«</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">âš”ï¸ æ”»å‡»æ€§</label>
                        <select id="aggressiveness" class="w-full px-3 py-2 border rounded-lg">
                            <option>æ— æ”»å‡»æ€§</option>
                            <option>è½»å¾®æ”»å‡»æ€§</option>
                            <option>éœ€è¦è®­ç»ƒ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ğŸ˜Š æ€§æ ¼ç‰¹å¾</label>
                        <select id="personality" class="w-full px-3 py-2 border rounded-lg">
                            <option>å†…å‘å®‰é™</option>
                            <option>å¤–å‘æ´»æ³¼</option>
                            <option>æ€§æ ¼æ¸©å’Œ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">âš¡ ç²¾åŠ›æ—ºç››</label>
                        <select id="energyLevel" class="w-full px-3 py-2 border rounded-lg">
                            <option>æ‡’æ•£çˆ±ç¡è§‰</option>
                            <option>æ´»åŠ¨é‡é€‚ä¸­</option>
                            <option>ç²¾åŠ›ç‰¹åˆ«æ—º</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- ç…§ç‰‡ä¸Šä¼  -->
            <section class="mb-8">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">å® ç‰©ç…§ç‰‡</h2>
                <div class="mt-2">
                    <label class="block">
                        <span class="sr-only">é€‰æ‹©ç…§ç‰‡</span>
                        <input type="file" accept="image/*" class="block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-blue-50 file:text-blue-700
                            hover:file:bg-blue-100
                        ">
                    </label>
                </div>
            </section>

            <!-- é¢†å…»è¦æ±‚ -->
            <section class="mb-8">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">é¢†å…»è¦æ±‚</h2>
                <div class="space-y-6">
                    <!-- æŠ¼é‡‘è®¾ç½® -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <label class="text-gray-700 font-medium">æ˜¯å¦éœ€è¦æŠ¼é‡‘</label>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="depositSwitch" class="sr-only peer" onchange="toggleDeposit()">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <!-- æŠ¼é‡‘ç›¸å…³é€‰é¡¹ï¼ˆé»˜è®¤éšè—ï¼‰ -->
                        <div id="depositOptions" class="hidden space-y-4">
                            <div>
                                <label class="block text-gray-700 mb-2">æŠ¼é‡‘é‡‘é¢ï¼ˆå…ƒï¼‰</label>
                                <input type="number" 
                                       id="depositAmount" 
                                       class="w-full px-3 py-2 border rounded-lg" 
                                       placeholder="è¯·è¾“å…¥æŠ¼é‡‘é‡‘é¢">
                            </div>
                            
                            <!-- æŠ¼é‡‘é€€è¿˜æ¡ä»¶ -->
                            <div>
                                <label class="block text-gray-700 mb-2">æŠ¼é‡‘é€€è¿˜æ¡ä»¶</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="depositReturn" id="depositReturn1Month" value="1month" class="text-blue-600">
                                        <span>é¥²å…»æ»¡1ä¸ªæœˆ</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="depositReturn" id="depositReturn3Month" value="3month" class="text-blue-600">
                                        <span>é¥²å…»æ»¡3ä¸ªæœˆ</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="depositReturn" id="depositReturn6Month" value="6month" class="text-blue-600">
                                        <span>é¥²å…»æ»¡6ä¸ªæœˆ</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="depositReturn" id="depositReturnVisit" value="visit" class="text-blue-600">
                                        <span>å®Œæˆæ‰€æœ‰å›è®¿</span>
                                    </label>
                                    <div class="mt-2">
                                        <input type="text" 
                                               id="depositReturnOther" 
                                               class="w-full px-3 py-2 border rounded-lg" 
                                               placeholder="å…¶ä»–é€€è¿˜æ¡ä»¶ï¼ˆé€‰å¡«ï¼‰">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å›è®¿è¦æ±‚ -->
                    <div>
                        <div class="space-y-4">
                            <!-- å›è®¿æ—¶é•¿ -->
                            <div>
                                <label class="block text-gray-700 mb-2">å›è®¿æ—¶é•¿</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="visitDuration" id="visitDuration1Month" class="text-blue-600">
                                        <span>é¢†å…»å1ä¸ªæœˆå†…</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="visitDuration" id="visitDuration3Month" class="text-blue-600">
                                        <span>é¢†å…»å3ä¸ªæœˆå†…</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="visitDuration" id="visitDuration6Month" class="text-blue-600">
                                        <span>é¢†å…»å6ä¸ªæœˆå†…</span>
                                    </label>
                                </div>
                            </div>

                            <!-- å›è®¿é¢‘ç‡ -->
                            <div>
                                <label class="block text-gray-700 mb-2">å›è®¿é¢‘ç‡</label>
                                <select id="visitFrequency" class="w-full px-3 py-2 border rounded-lg">
                                    <option>æ¯å‘¨ä¸€æ¬¡</option>
                                    <option>æ¯ä¸¤å‘¨ä¸€æ¬¡</option>
                                    <option>æ¯æœˆä¸€æ¬¡</option>
                                    <option>æ¯ä¸¤æœˆä¸€æ¬¡</option>
                                    <option>æ¯å­£åº¦ä¸€æ¬¡</option>
                                </select>
                            </div>

                            <!-- å›è®¿å½¢å¼ -->
                            <div>
                                <label class="block text-gray-700 mb-2">å›è®¿å½¢å¼</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="visitTypeVideo" class="rounded text-blue-600">
                                        <span>è§†é¢‘å›è®¿</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="visitTypeHome" class="rounded text-blue-600">
                                        <span>ä¸Šé—¨å›è®¿</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="visitTypePhoto" class="rounded text-blue-600">
                                        <span>ç…§ç‰‡è®°å½•</span>
                                    </label>
                                </div>
                            </div>

                            <div class="mt-2">
                                <textarea id="visitOtherRequirements" 
                                          class="w-full px-3 py-2 border rounded-lg" 
                                          rows="2" 
                                          placeholder="å…¶ä»–å›è®¿è¦æ±‚è¯´æ˜"></textarea>
                            </div>
                        </div>
                    </div>

                <!-- è¯•å…»å’Œé€€å›æ”¿ç­– -->
                <div class="md:col-span-2">
                    <h3 class="text-lg font-medium text-gray-800 mb-3">è¯•å…»æ”¿ç­–</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- æ˜¯å¦æ¥å—è¯•å…» -->
                        <div>
                            <label class="block text-gray-700 mb-2">æ˜¯å¦æ¥å—è¯•å…»</label>
                            <select class="w-full px-3 py-2 border rounded-lg" id="trialSelect" onchange="toggleTrialOptions()">
                                <option value="yes">æ¥å—è¯•å…»</option>
                                <option value="no">ä¸æ¥å—è¯•å…»</option>
                            </select>
                        </div>

                        <!-- è¯•å…»æ—¶é•¿ -->
                        <div id="trialDuration">
                            <label class="block text-gray-700 mb-2">è¯•å…»æ—¶é•¿</label>
                            <select class="w-full px-3 py-2 border rounded-lg">
                                <option>1å‘¨</option>
                                <option>2å‘¨</option>
                                <option>3å‘¨</option>
                            </select>
                        </div>

                        <!-- å…»è¯´æ˜ -->
                        <div class="md:col-span-2" id="trialNotice">
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <p class="text-yellow-700 text-sm">
                                    <span class="font-medium">æç¤ºï¼š</span>
                                    è¯•å…»æœŸç»“æŸåè‡ªåŠ¨è½¬ä¸ºæ­£å¼é¢†å…»ï¼Œä¸æ¥å—é€€å…»ã€‚è¯·åœ¨è¯•å…»æœŸé—´è®¤çœŸè€ƒè™‘æ˜¯å¦èƒ½å¤Ÿé•¿æœŸé¥²å…»ã€‚
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                function toggleTrialOptions() {
                    const select = document.getElementById('trialSelect');
                    const duration = document.getElementById('trialDuration');
                    const notice = document.getElementById('trialNotice');
                    
                    if (select.value === 'no') {
                        duration.style.display = 'none';
                        notice.style.display = 'none';
                    } else {
                        duration.style.display = 'block';
                        notice.style.display = 'block';
                    }
                }
                </script>
                </div>
            </section>

            <!-- æäº¤æŒ‰é’®åŒºåŸŸ -->
            <div class="space-y-4">
                <!-- æŒ‰é’®ç»„ -->
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button type="button" onclick="generateAdoptionImage()" 
                            class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                        ç”Ÿæˆé¢†å…»ä¿¡æ¯å›¾ç‰‡
                    </button>
                    <button type="button" onclick="generateAdoptionAgreement()" 
                            class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 transition-colors">
                        ç”Ÿæˆé¢†å…»åè®®
                    </button>
                </div>
                
                <!-- æé†’æ–‡å­— -->
                <div class="text-center">
                    <p class="text-red-600 text-sm">
                        è¯·ç¡®ä¿å¡«å†™çš„æ‰€æœ‰ä¿¡æ¯çœŸå®æœ‰æ•ˆï¼Œè¿™å°†ä½œä¸ºæ­£å¼çš„é¢†å…»åè®®ä¾æ®
                    </p>
                </div>
            </div>
        </form>
    </div>

    <!-- æ·»åŠ é¡µè„š -->
    <footer class="text-center py-4 text-gray-500 text-sm">
        <p>è”ç³»é‚®ç®±ï¼šcloudstickerforapple@gmaiil.com</p>
    </footer>

    <!-- é›†ä¸­ç®¡ç†JavaScriptä»£ç  -->
    <script>
        // é¡µåŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
            initializeEventListeners();
            // åŠ è½½å·²ä¿å­˜çš„è¡¨å•æ•°æ®
            loadSavedFormData();

            // æ£€æµ‹æ˜¯å¦åœ¨å¾®ä¿¡ç¯å¢ƒä¸­
            function isWechat() {
                return /MicroMessenger/i.test(navigator.userAgent);
            }

            // å¦‚æœåœ¨å¾®ä¿¡ä¸­ï¼Œæ˜¾ç¤ºæç¤º
            if (isWechat()) {
                document.getElementById('wechatTip').classList.remove('hidden');
            }
        });

        // åˆå§‹åŒ–æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
        function initializeEventListeners() {
            // æŠ¼é‡‘å¼€å…³ç›‘å¬
            const depositSwitch = document.getElementById('depositSwitch');
            if (depositSwitch) {
                depositSwitch.addEventListener('change', toggleDeposit);
            }

            // è¡¨å•æäº¤ç›‘å¬
            const form = document.querySelector('form');
            if (form) {
                form.addEventListener('submit', handleFormSubmit);
            }

            // ä¸ºæ‰€æœ‰è¾“å…¥å…ƒç´ æ·»åŠ å®æ—¶ç›‘å¬å™¨
            document.querySelectorAll('input, select, textarea').forEach(element => {
                // å¯¹äºæœ¬è¾“å…¥ã€æ•°å­—è¾“å’Œæ–‡æœ¬åŒºåŸŸï¼Œä½¿ç”¨ input äº‹ä»¶å®ç°å®æ—¶ä¿å­˜
                if (['text', 'number', 'textarea'].includes(element.type) || element.tagName.toLowerCase() === 'textarea') {
                    element.addEventListener('input', saveFormData);
                }
                // å¯¹äºé€‰æ‹©æ¡†ã€å¤é€‰æ¡†å’Œé€‰æ¡†ï¼Œç”¨ change äº‹ä»¶
                else {
                    element.addEventListener('change', saveFormData);
                }
            });
        }

        // åˆ‡æ¢æŠ¼é‡‘é€‰é¡¹æ˜¾ç¤º/éšè—
        function toggleDeposit() {
            const depositOptions = document.getElementById('depositOptions');
            const depositSwitch = document.getElementById('depositSwitch');
            if (depositOptions && depositSwitch) {
                depositOptions.classList.toggle('hidden', !depositSwitch.checked);
            }
        }

        // ä¿å­˜è¡¨å•æ•°æ®åˆ°localStorage
        function saveFormData() {
            const formData = {};
            
            // é›†æ‰€æœ‰è¾“å…¥æ¡†çš„å€¼
            document.querySelectorAll('input, select, textarea').forEach(element => {
                // è·³è¿‡æ–‡ä»¶è¾“å…¥æ¡†
                if (element.type === 'file') return;
                
                // è·å–å…ƒç´ çš„æ ‡è¯†ç¬¦
                const identifier = element.id || element.name;
                if (!identifier) return;

                // æ ¹æ®ä¸åŒå‹çš„è¾“å…¥ä¿å­˜ä¸åŒçš„å€¼
                if (element.type === 'checkbox') {
                    formData[identifier] = element.checked;
                } 
                else if (element.type === 'radio') {
                    if (element.checked) {
                        formData[identifier] = element.value;
                    }
                } 
                else {
                    formData[identifier] = element.value;
                }
            });

            // ä¿å­˜åˆ°localStorage
            try {
                localStorage.setItem('adoptionFormData', JSON.stringify(formData));
                console.log('è¡¨å•æ•°å·²è‡ªåŠ¨ä¿å­˜'); // å¯é€‰çš„ä¿å­˜ç¡®è®¤
            } catch (e) {
                console.error('ä¿å­˜è¡¨å•æ•°æ®å¤±è´¥:', e);
            }
        }

        // ä»localStorageåŠ è½½è¡¨å•æ•°æ®
        function loadSavedFormData() {
            const savedData = localStorage.getItem('adoptionFormData');
            if (!savedData) return;

            const formData = JSON.parse(savedData);
            
            // å¡«å……è¡¨å•æ•°æ®
            Object.entries(formData).forEach(([key, value]) => {
                const element = document.getElementById(key) || document.getElementsByName(key)[0];
                if (!element) return;

                if (element.type === 'checkbox' || element.type === 'radio') {
                    element.checked = value;
                } else {
                    element.value = value;
                }
            });

            // ç¡®ä¿æŠ¼é‡‘é€‰é¡¹çš„æ˜¾ç¤ºçŠ¶æ€æ­£ç¡®
            toggleDeposit();
            // ç¡®ä¿è¯•å…»é€‰é¡¹çš„æ˜¾ç¤ºçŠ¶æ€æ­£ç¡®
            toggleTrialOptions();
        }

        // å¤„ç†è¡¨å•æäº¤
        function handleFormSubmit(event) {
            event.preventDefault();
            
            // é›†è¡¨å•æ•°æ®
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());

            // éªŒè¯è¡¨å•æ•°æ®
            if (validateForm(data)) {
                // æäº¤æˆåŠŸåæ¸…é™¤localStorageä¸­çš„æ•°æ®
                localStorage.removeItem('adoptionFormData');
                // TODO: å¤„ç†è¡¨å•æäº¤
                console.log('è¡¨å•æ•°æ®ï¼š', data);
            }
        }

        // è¡¨å•éªŒè¯
        function validateForm(data) {
            // TODO: æ·»åŠ è¡¨å•éªŒè¯é€»è¾‘
            return true;
        }

        // ç”Ÿæˆé¢†å…»ä¿¡æ¯
        function generateAdoptionInfo(data) {
            // TODO: æ·»åŠ ç”Ÿæˆé¢†å…»ä¿¡æ¯çš„é€»è¾‘
        }

        // è¾…åŠ©å‡½æ•°ï¼šæ˜¾ç¤ºé”™è¯¯æ¯
        function showError(message) {
            // TODO: æ·»åŠ é”™è¯¯æç¤ºé€»è¾‘
            console.error(message);
        }

        // è¾…åŠ©å‡½æ•°ï¼šæ˜¾ç¤ºæˆåŠŸä¿¡æ¯
        function showSuccess(message) {
            // TODO: æ·»åŠ æˆåŠŸæç¤ºé€»è¾‘
            console.log(message);
        }

        // æ·»åŠ ä¸€ä¸ªè·å–è¡¨å•å€¼çš„è¾…åŠ©å‡½æ•°ï¼ŒåŒ…å«é»˜è®¤å€¼å¤„ç†
        function getFormValue(elementId, defaultValue = 'æœªå¡«å†™') {
            const element = document.getElementById(elementId);
            if (!element || !element.value) return defaultValue;
            
            const value = String(element.value).trim();
            return value || defaultValue;
        }

        // æ·»åŠ ä¸€ä¸ªè·å–æŠ¼é‡‘é€€è¿˜æ¡ä»¶çš„è¾…åŠ©å‡½æ•°
        function getDepositReturnCondition() {
            const conditions = {
                'depositReturn1Month': 'é¥²å…»æ»¡1ä¸ªæœˆ',
                'depositReturn3Month': 'é¥²å…»æ»¡3ä¸ªæœˆ',
                'depositReturn6Month': 'é¥²å…»æ»¡6ä¸ªæœˆ',
                'depositReturnVisit': 'å®Œæˆæ‰€æœ‰å›è®¿'
            };
            
            for (const [id, text] of Object.entries(conditions)) {
                if (document.getElementById(id)?.checked) {
                    return text;
                }
            }
            
            // æ£€æŸ¥å…¶ä»–æ¡ä»¶
            const otherCondition = getFormValue('depositReturnOther', '').trim();
            return otherCondition || 'æ— ç‰¹æ®Šæ¡ä»¶';
        }

        // æ·»åŠ ä¸€ä¸ªè·å–å›è®¿æ—¶é•¿çš„è¾…åŠ©å‡½æ•°
        function getVisitDuration() {
            const durations = {
                'visitDuration1Month': '1ä¸ªæœˆå†…',
                'visitDuration3Month': '3ä¸ªæœˆå†…',
                'visitDuration6Month': '6ä¸ªæœˆå†…'
            };
            
            for (const [id, text] of Object.entries(durations)) {
                const element = document.getElementById(id);
                if (element?.checked) {
                    return text;
                }
            }
            return 'æœªæŒ‡å®š';
        }

        // ç”Ÿæˆé¢†å…»ä¿¡æ¯å›¾ç‰‡
        async function generateAdoptionImage() {
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // è®¾ç½®ç”»å¸ƒå°ºå¯¸
                canvas.width = 1080;
                canvas.height = 1540;
                
                // ä½¿ç”¨æ›´æŸ”å’Œçš„èƒŒæ™¯è‰²
                ctx.fillStyle = '#F8FAFC';  // æ›´æ”¹ä¸ºæµ…ç°ç™½è‰²èƒŒæ™¯
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // è°ƒæ•´å¸ƒå±€å‚æ•°
                const layout = {
                    photoSize: 400,          // å¢å¤§ç…§ç‰‡å°ºå¯¸
                    topMargin: 50,           // é¡¶éƒ¨è¾¹è·
                    leftPadding: 50,         // å·¦ä¾§è¾¹è·
                    sectionSpacing: 60,      // æ®µè½é—´è·
                    lineHeight: 48,          // å¢åŠ è¡Œé«˜
                    titleBottomMargin: 20,   // æ ‡ä¸‹æ–¹è¾¹è·
                    columnGap: 80            // å¢åŠ åˆ—é—´è·
                };

                // ç»˜åˆ¶å® ç‰©ç…§ç‰‡
                const fileInput = document.querySelector('input[type="file"]');
                if (fileInput.files && fileInput.files[0]) {
                    const img = new Image();
                    img.src = URL.createObjectURL(fileInput.files[0]);
                    
                    await new Promise((resolve, reject) => {
                        img.onload = () => {
                            const x = (canvas.width - layout.photoSize) / 2;
                            const y = layout.topMargin;
                            
                            ctx.save();
                            ctx.beginPath();
                            ctx.roundRect(x, y, layout.photoSize, layout.photoSize, 16);
                            ctx.clip();
                            
                            const scale = Math.max(layout.photoSize / img.width, layout.photoSize / img.height);
                            const scaledWidth = img.width * scale;
                            const scaledHeight = img.height * scale;
                            
                            ctx.drawImage(img, 
                                x + (layout.photoSize - scaledWidth) / 2, 
                                y + (layout.photoSize - scaledHeight) / 2, 
                                scaledWidth, 
                                scaledHeight);
                            
                            ctx.restore();
                            resolve();
                        };
                        img.onerror = reject;
                    });
                }

                // è°ƒæ•´æ–‡å­—å§‹ä½ç½®
                let currentY = layout.topMargin + layout.photoSize + layout.sectionSpacing;
                const columnWidth = (canvas.width - (layout.leftPadding * 3)) / 2;

                // ä¼˜åŒ–ç»˜åˆ¶ä¸¤åˆ—å¸ƒå±€çš„å‡½æ•°
                function drawTwoColumnSection(leftSection, rightSection, y) {
                    // å·¦åˆ—æ ‡é¢˜ - ä½¿ç”¨åŠé€æ˜æ·±è‰²
                    ctx.fillStyle = 'rgba(31, 41, 55, 0.85)';  // æ·±è‰²å¸¦é€æ˜åº¦
                    ctx.font = 'bold 38px "LXGW WenKai"';
                    ctx.fillText(leftSection.title, layout.leftPadding, y);
                    
                    // å·¦åˆ—å†…å®¹ - ä½¿ç”¨æ›´æµ…çš„æ–‡å­—é¢œè‰²
                    ctx.fillStyle = 'rgba(51, 51, 51, 0.75)';  // å†…å®¹æ–‡å­—é¢œè‰²å¸¦é€æ˜åº¦
                    ctx.font = '34px "LXGW WenKai"';
                    const leftContent = leftSection.content.split('\n');
                    let currentLeftY = y + layout.titleBottomMargin + layout.lineHeight;
                    leftContent.forEach(line => {
                        ctx.fillText(line, layout.leftPadding, currentLeftY);
                        currentLeftY += layout.lineHeight;
                    });

                    // å³åˆ—æ ‡é¢˜
                    const rightColumnX = canvas.width/2 + layout.leftPadding;
                    ctx.fillStyle = 'rgba(31, 41, 55, 0.85)';  // æ·±è‰²å¸¦é€æ˜åº¦
                    ctx.font = 'bold 38px "LXGW WenKai"';
                    ctx.fillText(rightSection.title, rightColumnX, y);
                    
                    // å³åˆ—å†…å®¹
                    ctx.fillStyle = 'rgba(51, 51, 51, 0.75)';  // å†…å®¹æ–‡å­—é¢œè‰²å¸¦é€æ˜åº¦
                    ctx.font = '34px "LXGW WenKai"';
                    const rightContent = rightSection.content.split('\n');
                    let currentRightY = y + layout.titleBottomMargin + layout.lineHeight;
                    rightContent.forEach(line => {
                        ctx.fillText(line, rightColumnX, currentRightY);
                        currentRightY += layout.lineHeight;
                    });

                    return Math.max(currentLeftY, currentRightY);
                }

                // ä¼˜åŒ–ç»˜åˆ¶å•åˆ—å¸ƒå±€çš„å‡½æ•°
                function drawSingleColumnSection(section, y) {
                    ctx.fillStyle = 'rgba(31, 41, 55, 0.85)';  // æ·±è‰²å¸¦é€æ˜åº¦
                    ctx.font = 'bold 38px "LXGW WenKai"';
                    ctx.fillText(section.title, layout.leftPadding, y);
                    
                    ctx.fillStyle = 'rgba(51, 51, 51, 0.75)';  // å†…å®¹æ–‡å­—é¢œè‰²å¸¦é€æ˜åº¦
                    ctx.font = '34px "LXGW WenKai"';
                    const content = section.content.split('\n');
                    let currentY = y + layout.titleBottomMargin + layout.lineHeight;
                    content.forEach(line => {
                        ctx.fillText(line, layout.leftPadding, currentY);
                        currentY += layout.lineHeight;
                    });
                    return currentY;
                }

                // å‡†å¤‡å„éƒ¨åˆ†å†…å®¹
                const basicInfo = {
                    title: 'åŸºæœ¬ä¿¡æ¯',
                    content: `ğŸ¾ åå­—ï¼š${getFormValue('petName', 'æœªå‘½å')}
ğŸ“… å¹´é¾„ï¼š${getFormValue('petAge', 'æœªçŸ¥')}å²
âš¤ æ€§åˆ«ï¼š${getFormValue('petGender', 'æœªçŸ¥')}
ğŸ• å“ç§ï¼š${getFormValue('petBreed', 'æœªçŸ¥')}
âš–ï¸ ä½“é‡ï¼š${getFormValue('petWeight', 'æœªçŸ¥')}kg`
                };

                const adoptionBackground = {
                    title: 'é¢†å…»èƒŒæ™¯',
                    content: `ğŸ“ å¯æ¥å—é¢†å…»åœ°ç‚¹ï¼š${getFormValue('adoptionLocation', 'å¾…å•†è®®')}
ğŸ“ å® ç‰©æ¥å†ï¼š${getFormValue('petOrigin', 'æœªçŸ¥')}
ğŸ’­ é¢†å…»åŸå› ï¼š${getFormValue('adoptionReason', 'æš‚æ— è¯´æ˜')}`
                };

                const healthStatus = {
                    title: 'å¥åº·çŠ¶å†µ',
                    content: `ğŸ’‰ ç–«è‹—æƒ…å†µï¼š${getFormValue('vaccineStatus', 'æœªçŸ¥')}
âœ‚ï¸ ç»è‚²çŠ¶æ€ï¼š${getFormValue('sterilizationStatus', 'æœªçŸ¥')}
ğŸ¥ ä½“æ£€æƒ…å†µï¼š${getFormValue('medicalCheckStatus', 'æœªçŸ¥')}
ğŸ¥ æ‚£ç—…å†å²ï¼š${getFormValue('medicalHistory', 'æ— ')}`
                };

                const personality = {
                    title: 'æ€§æ ¼ç‰¹å¾',
                    content: `ğŸš½ å®šç‚¹å¤§å°ä¾¿ï¼š${getFormValue('toiletHabit', 'æœªçŸ¥')}
ğŸ”Š åµé—¹çŠ¶å†µï¼š${getFormValue('noiseLevel', 'æœªçŸ¥')}
âš”ï¸ æ”»å‡»æ€§ï¼š${getFormValue('aggressiveness', 'æœªçŸ¥')}
ğŸ˜Š æ€§æ ¼ï¼š${getFormValue('personality', 'æœªçŸ¥')}
âš¡ æ´»è·ƒç¨‹åº¦ï¼š${getFormValue('energyLevel', 'æœªçŸ¥')}`
                };

                const adoptionRequirements = {
                    title: 'é¢†å…»è¦æ±‚',
                    content: `è¯•å…»è¦æ±‚ï¼š${document.getElementById('trialSelect')?.value === 'yes' ? 
                            `æ¥å—è¯•å…»ï¼ˆ${getFormValue('trialDuration', 'æ—¶é•¿æœªå®š')}ï¼‰` : 'ä¸æ¥å—è¯•å…»'}
æŠ¼é‡‘è¦æ±‚ï¼š${document.getElementById('depositSwitch')?.checked ? 
                `éœ€è¦æŠ¼é‡‘${getFormValue('depositAmount', 'é‡‘é¢æœªå®š')}å…ƒï¼ˆé€€è¿˜æ¡ä»¶ï¼š${getDepositReturnCondition()}ï¼‰` : 'ä¸éœ€è¦æŠ¼é‡‘'}
å›è®¿è¦æ±‚ï¼š${getVisitDuration()}ï¼Œ${getFormValue('visitFrequency', 'å¾…å•†è®®')}
å›è®¿å½¢å¼ï¼š${[
    document.getElementById('visitTypeVideo')?.checked ? 'è§†é¢‘å›è®¿' : '',
    document.getElementById('visitTypeHome')?.checked ? 'ä¸Šé—¨å›è®¿' : '',
    document.getElementById('visitTypePhoto')?.checked ? 'ç…§ç‰‡è®°å½•' : ''
].filter(Boolean).join('ã€') || 'å¾…å•†è®®'}
å…¶ä»–è¦æ±‚ï¼š${getFormValue('visitOtherRequirements', 'æ— ')}`
                };

                // è°ƒæ•´ç»˜åˆ¶é—´è·
                currentY = drawTwoColumnSection(basicInfo, adoptionBackground, currentY);
                currentY = drawTwoColumnSection(healthStatus, personality, currentY + layout.sectionSpacing);
                currentY = drawSingleColumnSection(adoptionRequirements, currentY + layout.sectionSpacing);

                // åœ¨ç»˜åˆ¶å®Œæ‰€æœ‰å†…å®¹åï¼Œæ·»åŠ æ°´å°
                function drawWatermark() {
                    const watermarkText = 'LingYang.000ooo.ooo';
                    ctx.save();
                    
                    // è®¾ç½®æ°´å°æ ·å¼
                    ctx.font = '28px "LXGW WenKai"';
                    ctx.fillStyle = 'rgba(51, 51, 51, 0.3)';  // ä½¿ç”¨åŠé€æ˜ç°è‰²
                    
                    // è®¡ç®—æ°´å°ä½ç½®ï¼ˆå³ä¸‹è§’ï¼Œç•™å‡ºè¾¹è·ï¼‰
                    const padding = 40;
                    const metrics = ctx.measureText(watermarkText);
                    const x = canvas.width - metrics.width - padding;
                    const y = canvas.height - padding;
                    
                    // ç»˜åˆ¶æ°´å°
                    ctx.fillText(watermarkText, x, y);
                    ctx.restore();
                }

                // æœ€åç»˜åˆ¶æ°´å°
                drawWatermark();

                // å°† canvas è½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¸‹è½½
                const dataUrl = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                const petName = document.getElementById('petName').value || 'å® ç‰©';
                link.download = `${petName}-é¢†å…»ä¿¡æ¯.png`;
                link.href = dataUrl;
                link.click();
                
            } catch (error) {
                console.error('ç”Ÿæˆå›¾ç‰‡å¤±è´¥:', error);
                alert('ç”Ÿæˆå›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // ç”Ÿæˆé¢†å…»åè®®
        async function generateAdoptionAgreement() {
            try {
                // åˆ›å»ºå†…å®¹å…ƒç´ 
                const element = document.createElement('div');
                element.style.cssText = `
                    width: 1588px;  /* 794px * 2 */
                    background: white;
                    font-family: SimSun;
                    box-sizing: border-box;
                `;
                
                // å¢åŠ å­—ä½“å¤§å°ä»¥æé«˜æ¸…æ™°åº¦
                element.innerHTML = `
                    <div style="font-size: 42px; line-height: 1.6;">
                        <!-- ç¬¬ä¸€é¡µåˆ°ç¬¬å››é¡µä½¿ç”¨æ›´å¤§çš„å­—ä½“ -->
                        <div class="page first-four-pages">
                            <h1 style="text-align: center; margin-bottom: 40px; font-size: 80px;">é¢†å…»åè®®</h1>
                            
                            <!-- å‰è¨€éƒ¨åˆ† -->
                            <div style="margin-bottom: 30px;">
                                <p>ç”²æ–¹ï¼ˆé€å…»æ–¹ï¼‰ï¼š________________</p>
                                <p>èº«ä»½è¯å·ï¼š____________________</p>
                                <p>è”ç³»ç”µè¯ï¼š____________________</p>
                                <p>ä¹™æ–¹ï¼ˆé¢†å…»æ–¹ï¼‰ï¼š________________</p>
                                <p>èº«ä»½è¯å·ï¼š____________________</p>
                                <p>è”ç³»ç”µè¯ï¼š____________________</p>
                                <p>å±…ä½åœ°å€ï¼š____________________</p>
                            </div>

                            <!-- è¢«é¢†å…»åŠ¨ç‰©èµ„æ–™ -->
                            <div style="margin-bottom: 30px;">
                                <h3 style="margin-bottom: 20px; font-size: 32px;">è¢«é¢†å…»åŠ¨ç‰©èµ„æ–™ï¼š</h3>
                                <div style="margin-left: 40px;">
                                    <p>åŠ¨ç‰©å§“åï¼š${getFormValue('petName')}</p>
                                    <p>å¹´é¾„ï¼š${getFormValue('petAge')}å²</p>
                                    <p>æ€§æ ¼ç‰¹å¾ï¼š${getFormValue('personality')}</p>
                                    <p>å“ç§ï¼š${getFormValue('petBreed')}</p>
                                    <p>åŠ¨ç‰©æ€§åˆ«ï¼š${getFormValue('petGender')}ï¼ˆ${getFormValue('sterilizationStatus')}ï¼‰</p>
                                    <p>å…ç–«æƒ…å†µï¼š${getFormValue('vaccineStatus')}</p>
                                    <p>å¥åº·çŠ¶å†µï¼š${getFormValue('medicalHistory')}</p>
                                    <p>ä½“é‡ï¼š${getFormValue('petWeight')}kg</p>
                                </div>
                            </div>

                            <div style="margin-bottom: 30px;">
                                <p>ç”²ã€ä¹™åŒæ–¹æœ¬ç€å¹³ç­‰è‡ªæ„¿ã€è¯šå®ä¿¡ç”¨çš„åŸåˆ™ï¼Œç»å‹å¥½åå•†ï¼Œå°±å® ç‰©é¢†å…»äº‹å®œè¾¾æˆå¦‚ä¸‹åè®®ï¼š</p>
                            </div>
                        </div>

                        <div class="page first-four-pages" style="page-break-before: always;">
                            <h2 style="margin-bottom: 30px; font-size: 64px;">åè®®æ¡æ¬¾</h2>
                            
                            <p>ç¬¬ä¸€æ¡ é¢†å…»æ ‡çš„</p>
                            <div style="margin-left: 80px;">
                                <p>1.1 ç”²æ–¹å°†ä¸Šè¿°åŠ¨ç‰©ï¼ˆä»¥ä¸‹ç®€ç§°"é¢†å…»åŠ¨ç‰©"ï¼‰æ— å¿äº¤ç”±ä¹™æ–¹é¢†å…»ã€‚</p>
                                <p>1.2 ä¹™æ–¹ç¡®è®¤å·²å……åˆ†äº†è§£é¢†å…»åŠ¨ç‰©çš„çŠ¶å†µï¼Œå¹¶åŒæ„æ¥å—é¢†å…»ã€‚</p>
                            </div>

                            <p>ç¬¬äºŒæ¡ ç”²æ–¹çš„æƒåˆ©ä¸ä¹‰åŠ¡</p>
                            <div style="margin-left: 80px;">
                                <p>2.1 å¦‚å®æä¾›é€å…»åŠ¨ç‰©çš„åŸºæœ¬æƒ…å†µï¼ŒåŒ…æ‹¬å¹´é¾„ã€æ€§æ ¼ã€å…ç–«æƒ…å†µã€å¥åº·çŠ¶å†µç­‰ä»¥åŠä¹™æ–¹é—®è¯¢çš„å…¶ä»–æƒ…å†µã€‚</p>
                                <p>2.2 ä¸ä¹™æ–¹ä¿æŒè”ç³»ï¼Œè¿›è¡Œå›è®¿ï¼Œäº†è§£é€å…»åŠ¨ç‰©çš„æƒ…å†µã€‚</p>
                                <p>2.3 åœ¨ä¹™æ–¹é¢†å…»è¿‡ç¨‹ä¸­æä¾›å…³äºåŠ¨ç‰©é¥²å…»çš„å’¨è¯¢æœåŠ¡ã€‚</p>
                                <p>2.4 ç”²æ–¹æœ‰æƒå¯¹é¢†å…»åŠ¨ç‰©è¿›è¡Œå®šæœŸå›è®¿å’Œç›‘ç£ã€‚</p>
                                <p>2.5 å‘ç°ä¹™æ–¹è¿åæœ¬åè®®çº¦å®šæ—¶ï¼Œç”²æ–¹æœ‰æƒè¦æ±‚æ•´æ”¹æˆ–æ”¶å›é¢†å…»åŠ¨ç‰©ã€‚</p>
                            </div>

                            <p>ç¬¬ä¸‰æ¡ ä¹™æ–¹çš„æƒåˆ©ä¸ä¹‰åŠ¡</p>
                            <div style="margin-left: 80px;">
                                <p>3.1 ç¬¦åˆé¢†å…»åŠ¨ç‰©åŸºæœ¬æ¡ä»¶ï¼šå¹´æ»¡18å‘¨å²ï¼Œå…·æœ‰å®Œå…¨æ°‘äº‹è¡Œä¸ºèƒ½åŠ›ï¼Œæœ‰åˆæ³•çš„èº«ä»½è¯æ˜ï¼Œæœ‰å›ºå®šä½æ‰€ï¼Œæœ‰æ­£å½“èŒä¸šæˆ–ç»æµèƒ½åŠ›ã€‚</p>
                                <p>3.2 åœ¨é¢†å…»${getFormValue('petName')}å‰ï¼Œåº”éƒ‘é‡è€ƒè™‘å¹¶ç¡®ä¿å®¶åº­æˆå‘˜ä¸€è‡´åŒæ„ï¼›ç­¾ç½²é¢†å…»åè®®åï¼Œä¸å¾—å› å®¶äººåå¯¹ã€å©šå«ã€ç”Ÿè‚²ã€å·¥ä½œå˜åŠ¨ã€åŠ¨ç‰©ä¸é€‚åº”ã€åŠ¨ç‰©ç”Ÿç—…ç­‰åŸå› é€€è¿˜é¢†å…»åŠ¨ç‰©ã€‚</p>
                                <p>3.3 æä¾›é€‚å½“çš„é£Ÿç‰©å’Œæ¸…æ´çš„é¥®ç”¨æ°´ï¼Œç¡®ä¿ç§‘å­¦å–‚å…»ã€‚</p>
                                <p>3.4 æŒ‰æ—¶ä¸ºé¢†å…»åŠ¨ç‰©ä½“æ£€å’Œå…ç–«ï¼ˆåŒ…æ‹¬ç–«è‹—ã€é©±è™«ï¼‰ï¼Œé¢†å…»åŠ¨ç‰©ç”Ÿç—…æ—¶åŠæ—¶æ²»ç–—ã€‚</p>
                                <p>3.5 å¯¹é¢†å…»æ—¶å°šæœªç»è‚²çš„é¢†å…»åŠ¨ç‰©ï¼Œåº”æŒ‰ç…§çº¦å®šæ—¶é—´ï¼ˆé€šå¸¸ä¸ºé¢†å…»åŠ¨ç‰©ä¸€å‘¨å²å·¦å³ï¼‰è¿›è¡Œç»è‚²ã€‚</p>
                                <p>3.6 åœ¨ä½æ‰€ä¸ºé¢†å…»åŠ¨ç‰©æä¾›é€‚å½“çš„æ´»åŠ¨ç©ºé—´å¹¶ç¡®ä¿é¢†å…»åŠ¨ç‰©çš„å®‰å…¨ã€‚</p>
                                <p>3.7 ä¸å¾—è™å¾…æˆ–é—å¼ƒé¢†å…»åŠ¨ç‰©ã€‚</p>
                            </div>
                        </div>

                        <div class="page first-four-pages" style="page-break-before: always;">
                            <div style="margin-left: 80px;">
                                <p>3.13 ä¹™æ–¹åº”ç¡®ä¿å±…ä½ç¯å¢ƒé€‚åˆé¢†å…»åŠ¨ç‰©ç”Ÿæ´»ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
                                <div style="margin-left: 20px;">
                                    <p>- å®‰è£…é˜²æŠ¤ç½‘/é˜²ç›—é—¨ç­‰å®‰å…¨è®¾æ–½</p>
                                    <p>- æä¾›é€‚å½“çš„æ´»åŠ¨ç©ºé—´å’Œç©å…·</p>
                                    <p>- ä¿æŒç¯å¢ƒæ•´æ´å«ç”Ÿ</p>
                                </div>
                                <p>3.14 æœªç»ç”²æ–¹åŒæ„ï¼Œä¹™æ–¹ä¸å¾—å°†é¢†å…»åŠ¨ç‰©ç”¨äºç¹æ®–ã€å•†ä¸šå±•è§ˆç­‰è¥åˆ©æ€§ç”¨é€”ã€‚</p>
                                <p>3.15 ä¹™æ–¹åº”ä¿è¯åœ¨é¢†å…»æœŸé—´ä¸ä¼šå› ä¸ªäººåŸå› ï¼ˆå¦‚è´­æˆ¿é™åˆ¶ã€ç‰©ä¸šè§„å®šç­‰ï¼‰è€Œæ— æ³•ç»§ç»­é¥²å…»ã€‚</p>
                            </div>

                            ${document.getElementById('depositSwitch')?.checked ? `
                            <p>ç¬¬å››æ¡ æŠ¼é‡‘æ¡æ¬¾</p>
                            <div style="margin-left: 80px;">
                                <p>4.1 æŠ¼é‡‘é‡‘é¢åŠæ”¯ä»˜</p>
                                <div style="margin-left: 20px;">
                                    <p>4.1.1 ä¹™æ–¹åŒæ„å‘ç”²æ–¹æ”¯ä»˜é¢†å…»æŠ¼é‡‘ï¿¥${getFormValue('depositAmount')}.00</p>
                                    <p>4.1.2 æŠ¼é‡‘æ”¯ä»˜æ–¹å¼ï¼š________(ç°é‡‘/è½¬è´¦/å…¶ä»–)</p>
                                    <p>4.1.3 æ”¯ä»˜æ—¶é—´ï¼šé¢†å…»åŠ¨ç‰©äº¤ä»˜æ—¶æ”¯ä»˜</p>
                                </div>
                                <p>4.2 æŠ¼é‡‘é€€è¿˜æ¡ä»¶ï¼š${getDepositReturnCondition()}</p>
                                <p>4.3 æŠ¼é‡‘æ‰£é™¤æƒ…å½¢ï¼š</p>
                                <div style="margin-left: 20px;">
                                    <p>4.3.1 ä¹™æ–¹è¿åæœ¬åè®®çº¦å®šä¹‰åŠ¡</p>
                                    <p>4.3.2 æ‹’ç»é…åˆå›è®¿æˆ–æ— æ•…å¤±è”</p>
                                    <p>4.3.3 å‘ç”Ÿè™å¾…æˆ–é—å¼ƒè¡Œä¸º</p>
                                </div>
                            </div>
                            ` : ''}

                            <p>ç¬¬äº”æ¡ å›è®¿ç›‘ç£</p>
                            <div style="margin-left: 80px;">
                                <p>5.1 å›è®¿æœŸé™ï¼š${getVisitDuration()}</p>
                                <p>5.2 å›è®¿é¢‘ç‡ï¼š${getFormValue('visitFrequency')}</p>
                                <p>5.3 å›è®¿æ–¹å¼ï¼š${[
                                    document.getElementById('visitTypeVideo')?.checked ? 'è§†é¢‘å›è®¿' : '',
                                    document.getElementById('visitTypeHome')?.checked ? 'ä¸Šé—¨å›è®¿' : '',
                                    document.getElementById('visitTypePhoto')?.checked ? 'ç…§ç‰‡è®°å½•' : ''
                                ].filter(Boolean).join('ã€')}</p>
                                ${getFormValue('visitOtherRequirements') ? 
                                    `<p>5.4 å…¶ä»–è¦æ±‚ï¼š${getFormValue('visitOtherRequirements')}</p>` : ''}
                            </div>

                            <p>ç¬¬å…­æ¡ åè®®è§£é™¤</p>
                            <div style="margin-left: 80px;">
                                <p>6.1 æœ‰ä¸‹åˆ—æƒ…å½¢ä¹‹ä¸€çš„ï¼Œç”²æ–¹æœ‰æƒè§£é™¤åè®®å¹¶æ”¶å›é¢†å…»åŠ¨ç‰©ï¼š</p>
                                <div style="margin-left: 20px;">
                                    <p>6.1.1 ä¹™æ–¹è¿åæœ¬åè®®çº¦å®šçš„ä¹‰åŠ¡</p>
                                    <p>6.1.2 ä¹™æ–¹å­˜åœ¨è™å¾…ã€é—å¼ƒç­‰è¡Œä¸º</p>
                                    <p>6.1.3 ä¹™æ–¹æ‹’ç»é…åˆå›è®¿æˆ–è¿ç»­è¶…è¿‡30å¤©æ— æ•…å¤±è”</p>
                                    <p>6.1.4 å…¶ä»–ä¸¥é‡å½±å“é¢†å…»åŠ¨ç‰©æƒç›Šçš„æƒ…å½¢</p>
                                </div>
                            </div>
                        </div>

                        <div class="page first-four-pages" style="page-break-before: always;">
                            <p>ç¬¬ä¸ƒæ¡ è¿çº¦è´£ä»»</p>
                            <div style="margin-left: 80px;">
                                <p>7.1 ä¹™æ–¹è¿åæœ¬åè®®çº¦å®šï¼Œåº”æ‰¿æ‹…ç›¸åº”çš„è´£ä»»ï¼Œå¹¶èµ”å¿å› æ­¤ç»™ç”²æ–¹é€ æˆçš„å…¨éƒ¨æŸå¤±ã€‚</p>
                                <p>7.2 å¦‚ä¹™æ–¹å­˜åœ¨è™å¾…ã€é—å¼ƒç­‰è¡Œä¸ºï¼Œç”²æ–¹æœ‰æƒæ”¶å›é¢†å…»åŠ¨ç‰©ï¼Œå¹¶ä¿ç•™è¿½ç©¶ç›¸å…³æ³•å¾‹è´£ä»»çš„æƒåˆ©ã€‚</p>
                            </div>

                            <p>ç¬¬å…«æ¡ å…¶ä»–äº‹é¡¹</p>
                            <div style="margin-left: 80px;">
                                <p>8.1 æœ¬åè®®æœªå°½äº‹å®œï¼ŒåŒæ–¹å¯å¦è¡Œåå•†å¹¶ç­¾è®¢è¡¥å……åè®®ã€‚</p>
                                <p>8.2 æœ¬åè®®çš„ä»»ä½•ä¿®æ”¹å‡åº”é‡‡ç”¨ä¹¦é¢å½¢å¼ï¼Œå¹¶ç»åŒæ–¹ç­¾å­—è®¤å¯ã€‚</p>
                                <p>8.3 å› æœ¬åè®®å‘ç”Ÿçš„äº‰è®®ï¼ŒåŒæ–¹åº”å‹å¥½åå•†è§£å†³ï¼›åå•†ä¸æˆçš„ï¼Œä»»ä½•ä¸€æ–¹å‡å¯å‘ç”²æ–¹æ‰€åœ¨åœ°äººæ°‘æ³•é™¢æèµ·è¯‰è®¼ã€‚</p>
                                <p>8.4 æœ¬åè®®ä¸€å¼ä¸¤ä»½ï¼Œç”²ä¹™åŒæ–¹å„æ‰§ä¸€ä»½ï¼Œå…·æœ‰åŒç­‰æ³•å¾‹æ•ˆåŠ›ã€‚</p>
                            </div>

                            <!-- ç­¾ååŒºåŸŸ -->
                            <div style="margin-top: 80px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 40px;">
                                    <div>ç”²æ–¹ç­¾å­—ï¼š________________</div>
                                    <div>ä¹™æ–¹ç­¾å­—ï¼š________________</div>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <div>æ—¥æœŸï¼š____å¹´____æœˆ____æ—¥</div>
                                    <div>æ—¥æœŸï¼š____å¹´____æœˆ____æ—¥</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                `;
                
                // æ·»åŠ  CSS æ ·å¼
                const style = document.createElement('style');
                style.textContent = `
                    .page {
                        height: 2246px;
                        padding: 80px;
                        box-sizing: border-box;
                        position: relative;
                    }
                    .first-four-pages h3 {
                        font-size: 48px !important;
                    }
                    .first-four-pages div {
                        margin-left: 80px !important;
                    }
                `;
                element.appendChild(style);

                // æ·»åŠ åˆ°æ–‡æ¡£ä¸­ï¼ˆä½†éšè—ï¼‰
                element.style.position = 'absolute';
                element.style.left = '-9999px';
                document.body.appendChild(element);

                // æ˜¾ç¤ºåŠ è½½æç¤º
                const loadingMsg = document.createElement('div');
                loadingMsg.textContent = 'æ­£åœ¨ç”ŸæˆPDFï¼Œè¯·ç¨å€™...';
                loadingMsg.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 20px;
                    border-radius: 8px;
                    z-index: 9999;
                `;
                document.body.appendChild(loadingMsg);

                try {
                    // ç­‰å¾…å…ƒç´ æ¸²æŸ“
                    await new Promise(resolve => setTimeout(resolve, 1000));

                    // ä½¿ç”¨ html2canvas ç”Ÿæˆå›¾ç‰‡ï¼Œæé«˜æ¸²æŸ“è´¨é‡
                    const canvas = await html2canvas(element, {
                        scale: 2, // å¢åŠ ç¼©æ”¾æ¯”ä¾‹
                        useCORS: true,
                        logging: true,
                        width: 1588, // åŒå€å®½åº¦
                        height: 2246, // åŒå€é«˜åº¦
                        windowWidth: 1588,
                        windowHeight: 2246,
                        letterRendering: true, // å¯ç”¨å­—æ¯æ¸²æŸ“
                        imageTimeout: 0, // ç¦ç”¨å›¾ç‰‡è¶…æ—¶
                        removeContainer: true, // è‡ªåŠ¨ç§»é™¤ä¸´æ—¶å®¹å™¨
                        allowTaint: true, // å…è®¸è·¨åŸŸå›¾ç‰‡
                        backgroundColor: '#ffffff', // è®¾ç½®èƒŒæ™¯è‰²
                        onclone: (clonedDoc) => {
                            // å¯ä»¥åœ¨è¿™é‡Œå¯¹å…‹éš†çš„æ–‡æ¡£è¿›è¡Œé¢å¤–å¤„ç†
                            const clonedElement = clonedDoc.querySelector('div');
                            if (clonedElement) {
                                clonedElement.style.transform = 'none';
                            }
                        }
                    });

                    // åˆ›å»º PDF
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF({
                        unit: 'mm',
                        format: 'a4',
                        orientation: 'portrait'
                    });

                    // è·å–æ‰€æœ‰é¡µé¢å…ƒç´ 
                    const pages = element.querySelectorAll('.page');
                    
                    // é€é¡µå¤„ç†
                    for (let i = 0; i < pages.length; i++) {
                        // å¦‚æœä¸æ˜¯ç¬¬ä¸€é¡µï¼Œæ·»åŠ æ–°é¡µ
                        if (i > 0) {
                            pdf.addPage();
                        }

                        // ä¸ºæ¯ä¸€é¡µç”Ÿæˆ canvas
                        const canvas = await html2canvas(pages[i], {
                            scale: 2,
                            useCORS: true,
                            logging: false,
                            width: 1588,
                            height: 2246,
                            windowWidth: 1588,
                            windowHeight: 2246,
                            letterRendering: true,
                            allowTaint: true,
                            backgroundColor: '#ffffff'
                        });

                        // å°† canvas è½¬æ¢ä¸ºå›¾ç‰‡
                        const imgData = canvas.toDataURL('image/jpeg', 1.0);

                        // æ·»åŠ åˆ° PDF
                        pdf.addImage(imgData, 'JPEG', 0, 0, 210, 297, undefined, 'FAST');
                    }

                    // ä¿å­˜ PDF
                    pdf.save(`${getFormValue('petName', 'æœªå‘½åå® ç‰©')}-é¢†å…»åè®®.pdf`);

                } finally {
                    // æ¸…ç†ä¸´æ—¶å…ƒç´ 
                    document.body.removeChild(element);
                    document.body.removeChild(loadingMsg);
                }

            } catch (error) {
                console.error('PDF generation error:', error);
                alert('ç”ŸæˆPDFæ—¶å‘ç”Ÿé”™è¯¯ï¼š' + error.message);
            }
        }
    </script>
</body>
</html>
